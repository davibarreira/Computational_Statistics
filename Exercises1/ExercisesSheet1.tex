\documentclass[12pt,letterpaper]{article}
\usepackage{./preamble}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Edit These for yourself
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand\course{Computational Statistics}
\newcommand\hwnumber{1}
\newcommand\userID{Davi Sales Barreira}
\DeclareRobustCommand{\rchi}{{\mathpalette\irchi\relax}}
\newcommand{\irchi}[2]{\raisebox{\depth}{$#1\chi$}}

\begin{document}
% \textbf{\Large Worksheet completed with Octave.}
Notation: here is a brief summary of the notation used in this worksheet.
\begin{itemize}
\item $ p(X=x)$ is equal to the probability density function;
\item Capital letters such as $X$ stand for the random variable.
\end{itemize}

\section*{Exercise 1 (Inversion and Rejection)}
\begin{enumerate}[leftmargin=!,labelindent=5pt]
    \item Let $ F_X(x) = \mathbb{P}(X \leq x) $ and $U \sim Unif[0,1]$:
        % \begin{flalign}
            $$ F_X(x) = 1 - e^{-\lambda(X-a)}\mathbb{I}_{\{X \geq a\}}=U $$
            $$ -\ln(1-U) = \lambda(x-a) $$
            $$ F_X^{-1}(U) = a - \frac{-\ln(1-U)}{\lambda} $$
    To simulate X from U, just simulate value from U and substitute in the
    formula above.
        % \end{flalign}
        
    \item Let $X = Y \mid a \leq Y \leq b$.
    First, let's show that $X = F_Y^{-1}(F_Y(a)(1-U)+F_Y(b)U)$:

    % $$p(X=x \mid a \leq X \leq b) = \frac{p(X=x, a \leq X \leq b)}{p()}$$
    $$\mathbb{P}(X \leq x) = \mathbb{P}(F_Y^{-1}(F_Y(a)(1-U)+F_Y(b)U)\leq x)
    = \mathbb{P}(F_Y^{-1}(F_Y(a)+U[F_Y(b)-F_X(a)])\leq x)$$
    % If $x \notin [a,b]$ then $\mathbb{P}(X \leq x) = 0$.
    $$ = \mathbb{P}(F_Y(a)+U[F_Y(b)-F_X(a)]\leq F_Y(x)) = 
    \mathbb{P}\left(U \leq \frac{F_Y(x) - F_Y(a)}{F_Y(b)-F_Y(a)}\right)
    =\frac{F_Y(x) - F_Y(a)}{F_Y(b)-F_Y(a)}$$

    Note that since $x \in [a,b]$: 
    $$\mathbb{P}(Y \leq x \mid a \leq Y \leq b)
    = \frac{\mathbb{P}(Y \leq x, a \leq Y \leq b)}
    {\mathbb{P}(a \leq Y \leq b)}
    =\frac{\mathbb{P}(a \leq Y \leq x)}{F_Y(b) - F_Y(a)}
    =\frac{F_Y(x) - F_Y(a)}{F_Y(b)-F_Y(a)} = \mathbb{P}(X \leq x)$$

    Now that we proved the above relation, to simulate an exponential
    conditioned on $\geq a$, we first generate $U \sim Unif[0,1]$, then,
    for $Y \sim Expo(\lambda)$:
    $$F_Y(y) = 1 - e^{\lambda y} \therefore F_Y^{-1}(U)
    = \frac{-\ln(1-U)}{\lambda}$$
    $$X = \frac{-\ln(1 - (1-U)F_Y(a)+U)}{\lambda} = 
    \frac{-\ln(e^{-\lambda a}+U\cdot e^{-\lambda a})}{\lambda}
    = a - \frac{\ln(1-U)}{\lambda}
    $$
    The formula yields the same solution as the one obtained using
    inversion.

    \item Let $q \sim Expo(\lambda)$, and
    $\pi(x) = \lambda e^{-\lambda(x-a)}\mathbb{I}_{x\geq a}$:

    Note that $M = max_x\pi(x)/q(x) = e^{\lambda a}$, since
    $\pi(x)/q(x)
    = \frac{\lambda e^{-\lambda (x-a)}}{\lambda e^{\lambda (x)}}=
    e^{\lambda a}$
    $$\therefore$$

    In the rejection method, we sample $x_i \sim q$, $u \sim Unif[0,1]$
    ,then we accept a sample $x_i$ if
    $u_i \leq \frac{\pi(x_i)}{Mq(x_i)}$. 

    Hence,
    \begin{itemize}
    	\item If $x \leq a \implies \pi(x) = 0 \implies
    	u \leq 0 \therefore x_i$ is rejected;
    	\item If $x > a \implies \pi(x) = 1
    	\implies u \leq 1 \therefore x_i$ is accepted;
    \end{itemize}

    Which is the same procedure described in the question, implying that
    it is equal to the rejection algorithm.

    Finally, the expected number of trials is equal to $M = e^{\lambda a}$.
    Therefore, for $a \gg 1/\lambda$, the expected number of trials becomes 
    very large (greater computational cost), while this problem doesn't
    happen with inversion, since every sample is used.

\end{enumerate}

\newpage
\section*{Exercise 2 (Rejection)}
\begin{enumerate}[leftmargin=!,labelindent=5pt]

	\item Let $A$ be the event where the value is accepted at some point,
	while $A_b$ is accepted at step (b) and $A_c$ is accepted at step (c):

	In step (b) we have:
	$$\mathbb{P}(x \in A_b)
	= \frac{h(x)}{M\tilde{q}(x)}$$
	In step (c) we have:
	$$\mathbb{P}(x \in A_c)
	= \frac{\tilde{\pi}(x) - h(x)}{M\tilde{q}(x) - h(x)}$$
	Since step (b) is independent of (c),
	$$\mathbb{P}(x \in A) = \mathbb{P}(x \in A_b \cup x \in A_c) =$$
	$$= \mathbb{P}(x\in A_b)+\mathbb{P}(x\in A_b)-
	\mathbb{P}(x \in A_b \cap x \in A_c) = $$
	$$ = \frac{h(x)}{M\tilde{q}(x)} +
	\frac{\tilde{\pi}(x) - h(x)}{M\tilde{q}(x) - h(x)} + 
	\frac{h(x)}{M\tilde{q}(x)}\cdot
	\frac{\tilde{\pi}(x) - h(x)}{M\tilde{q}(x) - h(x)} =
	\frac{\tilde{\pi}(x)}{M\tilde{q}(x)}
	$$

	\item Let B be an arbitrary event.
	$$\mathbb{P}(X \in B \mid X \in A) =
	\mathbb{P}(X \in B \cap X \in A) / \mathbb{P}(X \in A) \therefore$$
	$$ \mathbb{P}(X \in B \cap X \in A) =
	\int_{\chi}\int_{0}^{1}
	\mathbb{I}_B(x)\mathbb{I}
	\left( u \leq \frac{\tilde{\pi}(x)}{M\tilde{q}(x)} \right) q(x) du dx$$
	$$ \mathbb{P}(X \in B \cap X \in A) =
	\int_{B}
	\frac{\tilde{\pi}(x)}{M\tilde{q}(x)}\tilde{q}(x)\cdot Z_q^{-1} dx$$
	$$ \mathbb{P}(X \in B \cap X \in A) =
	\frac{\pi(B)\cdot Z_\pi}{M \cdot Z_q}
	$$
	Finally,

	$$\mathbb{P}(X \in A) = \frac{Z_\pi}{M\cdot Z_q} \therefore 
	\mathbb{P}(X \in B \mid X \in A) =
	\frac{\pi(B) Z_\pi}{M Z_q}\cdot \frac{M Z_q}{Z_\pi} = \pi(B)$$.

	\item We want to show that:
	$$\mathbb{P}(\text{Step (c) is necessery}) = 1 - \frac{\int_{\chi}h(x)dx}{MZ_q}$$

	First, note that
	$\mathbb{P}(\text{Step (c) is necessery}) =
	\mathbb{P}(\text{X not accepted in step(b)})$, hence:

	$$\mathbb{P}(\text{X not accepted in step(b)}) = 
	1 - \mathbb{P}(X \in A_b) =
	1 - \mathbb{P}\left(U \leq \frac{h(X)}{M\tilde{q}(X)} \right)$$

	$$\mathbb{P}(X \in A_b) = \mathbb{P}(X \in \rchi \cap X \in A_b)=$$
	$$ \int_{\chi}\int_{0}^{1}
	\mathbb{I}_\chi(x)\mathbb{I}
	\left( u \leq \frac{h(x)}{M\tilde{q}(x)} \right) du dx = $$
	$$\int_{\chi}\frac{h(x)\tilde{q}(x)}{M\tilde{q}(x)Z_q}dx = 
	\frac{\int_{\chi}h(x)dx}{MZ_q} \therefore $$
	$$\mathbb{P}(\text{Step(c) is necessery}) = 1
	 - \frac{\int_{\chi}h(x)dx}{MZ_q}$$.

	 \item 


\end{enumerate}
% \setcounter{equation}{0}
% \begin{enumerate}[leftmargin=!,labelindent=5pt]
%     \item Equations from parts 1 and 2
%         \begin{enumerate}
%             \item Write the equation of the surface in the form $z = f(x, y)$.
%             \begin{flalign}
%                 f(x)=(x+a)(x+b)\\
%                 L' = {L}{\sqrt{1-\frac{v^2}{c^2}}} \\
%                 \lim_{x\to 0}{\frac{e^x-1}{2x}}\\
%                 \overset{\left[\frac{0}{0}\right]}{\underset{\mathrm{H}}{=}}\\
%                 \lim_{x\to 0}{\frac{e^x}{2}}={\frac{1}{2}}
%             \end{flalign}
        
%         \item Make inline math with dollar dollar y'all $woo$! Also centered equations. Tell LaTeX where you want to align equations with \&.
%             \begin{align*}
%                 f(x) &= x^2 \\
%                 g(x) &= \frac{1}{x} \\
%                 F(x) &= \int^a_b \frac{1}{3}x^3
%             \end{align*}
%         \end{enumerate}
%     \newpage
    
%     % \item Plots for Part 3
%     %     \begin{enumerate}
%     %         \item Good times.
%     %             \begin{figure}[H]
%     %                 \centering
%     %                 \includegraphics[width=15cm]{images/figure3.jpg}
%     %                 \caption{A meme.}
%     %                 \label{fig:3}
%     %             \end{figure}
%     %     \end{enumerate}
% \end{enumerate}
\end{document}